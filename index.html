<html><head><base href="https://"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>InzulSmart Balkan</title><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css"><link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkthbGt1bGF0b3IgSW56dWxpbmEiLAogICJzaG9ydF9uYW1lIjogIkluc3VsaW4gS2FsayIsCiAgInN0YXJ0X3VybCI6ICIvIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjZmZmZmZmIiwKICAidGhlbWVfY29sb3IiOiAiIzI4YTc0NSIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vYm9vdHN0cmFwLWljb25zQDEuMTAuNS9pY29ucy9kcm9wcGVyLWZpbGwuc3ZnIiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ=="><script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js').then(registration => {
      console.log('ServiceWorker registracija uspješna');
    }, err => {
      console.log('ServiceWorker registracija nije uspjela: ', err);
    });
  });
}
</script><style>
body { 
  padding-top: 60px; 
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-color: #f8f9fa;
}
.history-item { 
  border: 1px solid #dee2e6; 
  padding: 20px;
  background-color: #ffffff;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  margin-bottom: 20px;
  transition: all 0.3s ease;
}
.history-item:hover {
  transform: translateY(-5px);
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
.history-item .total-dose {
  font-size: 1.5rem;
  font-weight: bold;
  color: #28a745;
  margin-bottom: 15px;
  text-align: center;
  padding: 10px;
  background-color: #e9ecef;
  border-radius: 5px;
}
.history-item .input-data,
.history-item .result-data {
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 5px;
}
.history-item .input-data {
  background-color: #f8f9fa;
}
.history-item .result-data {
  background-color: #e9ecef;
}
.header { 
  background: linear-gradient(135deg, #28a745, #20c997);
  color: white;
  padding: 2rem 0;
  margin-bottom: 2rem;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}
.header h1 { font-weight: 700; }
.welcome-message { font-style: italic; }
.modal-content { border-radius: 15px; }
.modal-header { border-radius: 15px 15px 0 0; }
.modal-body { padding: 2rem; }
.modal-footer { border-radius: 0 0 15px 15px; }
.animate__animated { --animate-duration: 0.5s; }
.btn-primary, .bg-primary {
  background-color: #28a745 !important;
  border-color: #28a745 !important;
}
.btn-primary:hover {
  background-color: #218838 !important;
  border-color: #1e7e34 !important;
}
.navbar-dark .navbar-nav .nav-link.active {
  color: #ffffff;
  font-weight: bold;
}
.form-control:focus {
  border-color: #28a745;
  box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
}
.delete-btn {
  color: #dc3545;
  cursor: pointer;
  transition: all 0.3s ease;
}
.delete-btn:hover {
  color: #c82333;
  transform: scale(1.1);
}
</style></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top"><div class="container-fluid"><a class="navbar-brand" href="#"><i class="bi bi-droplet-fill me-2"></i>Kalkulator</a><button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNav"><ul class="navbar-nav"><li class="nav-item"><a class="nav-link active" aria-current="page" href="#" id="calculatorLink"><i class="bi bi-calculator me-1"></i>InzulSmart</a></li><li class="nav-item"><a class="nav-link" href="#" id="historyLink"><i class="bi bi-clock-history me-1"></i>Historija</a></li></ul></div></div></nav><div id="welcomePage" class="container"><div class="header text-center"><h1><i class="bi bi-heart-pulse me-2"></i>Dobrodošli u Kalkulator Inzulina</h1></div><form id="welcomeForm" class="mt-4"><div class="mb-3"><label for="userName" class="form-label">Unesite vaše ime:</label><input type="text" class="form-control" id="userName" required></div><button type="submit" class="btn btn-primary"><i class="bi bi-box-arrow-in-right me-2"></i>Započni</button></form></div><div id="mainApp" class="d-none"><div class="header"><div class="container"><h1><i class="bi bi-droplet-half me-2"></i>Kalkulator Inzulina</h1><p class="welcome-message" id="welcomeMessage"></p></div></div><div class="container" id="calculatorPage"><form id="insulinForm"><div class="mb-3"><label for="carbIntake" class="form-label">Koliko ćete ugljenih hidrata pojesti? (grama)</label><input type="number" class="form-control" id="carbIntake" required></div><div class="mb-3"><label for="bloodSugar" class="form-label">Koliko je visok šećer u krvi? (mmol/L)</label><input type="number" step="0.1" class="form-control" id="bloodSugar" required></div><div class="mb-3"><label for="carbRatio" class="form-label">Koji je vaš omjer ugljikohidrata i inzulina?</label><input type="number" step="0.1" class="form-control" id="carbRatio" required></div><div class="mb-3"><label for="insulinSensitivity" class="form-label">Koji je vaš faktor osjetljivosti?</label><input type="number" step="0.1" class="form-control" id="insulinSensitivity" required></div><div class="mb-3"><label for="targetBloodSugar" class="form-label">Koji je vaš ciljani šećer u krvi? (mmol/L)</label><input type="number" step="0.1" class="form-control" id="targetBloodSugar" required></div><button type="submit" class="btn btn-primary"><i class="bi bi-calculator me-2"></i>Izračunaj dozu inzulina</button></form><div id="result" class="mt-4"></div></div><div class="container d-none" id="historyPage"><h2 class="mb-4"><i class="bi bi-clock-history me-2"></i>Historija doza inzulina</h2><div id="historyList"></div></div></div><div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="resultModalLabel"><i class="bi bi-clipboard-data me-2"></i>Rezultat izračuna</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zatvori"></button></div><div class="modal-body" id="modalBody"></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="bi bi-x-circle me-2"></i>Zatvori</button></div></div></div></div><footer class="mt-5 text-center text-muted"><p>© 2024 InzulSmart. </p><p>Razvila Mr.med.sci dr. Azra Feukić, specijalista pedijatar, subspecijalista pedijatrijske endokrinologije </p></p></footer><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script><script>
const welcomePage = document.getElementById('welcomePage');
const mainApp = document.getElementById('mainApp');
const welcomeForm = document.getElementById('welcomeForm');
const welcomeMessage = document.getElementById('welcomeMessage');
const calculatorPage = document.getElementById('calculatorPage');
const historyPage = document.getElementById('historyPage');
const calculatorLink = document.getElementById('calculatorLink');
const historyLink = document.getElementById('historyLink');
const insulinForm = document.getElementById('insulinForm');
const resultDiv = document.getElementById('result');
const historyList = document.getElementById('historyList');
const resultModal = new bootstrap.Modal(document.getElementById('resultModal'));
const modalBody = document.getElementById('modalBody');

function showMainApp() {
  welcomePage.classList.add('d-none');
  mainApp.classList.remove('d-none');
}

function hideMainApp() {
  welcomePage.classList.remove('d-none');
  mainApp.classList.add('d-none');
}

// Check if user name is stored
const storedName = localStorage.getItem('userName');
if (storedName) {
  showMainApp();
  welcomeMessage.textContent = `Dobrodošli, ${storedName}!`;
} else {
  hideMainApp();
}

welcomeForm.addEventListener('submit', (e) => {
  e.preventDefault();
  const userName = document.getElementById('userName').value;
  localStorage.setItem('userName', userName);
  welcomeMessage.textContent = `Dobrodošli, ${userName}!`;
  showMainApp();
});

calculatorLink.addEventListener('click', (e) => {
  e.preventDefault();
  calculatorPage.classList.remove('d-none');
  historyPage.classList.add('d-none');
  calculatorLink.classList.add('active');
  historyLink.classList.remove('active');
});

historyLink.addEventListener('click', (e) => {
  e.preventDefault();
  calculatorPage.classList.add('d-none');
  historyPage.classList.remove('d-none');
  calculatorLink.classList.remove('active');
  historyLink.classList.add('active');
  displayHistory();
});

insulinForm.addEventListener('submit', (e) => {
  e.preventDefault();
  const carbIntake = parseFloat(document.getElementById('carbIntake').value);
  const bloodSugar = parseFloat(document.getElementById('bloodSugar').value);
  const carbRatio = parseFloat(document.getElementById('carbRatio').value);
  const insulinSensitivity = parseFloat(document.getElementById('insulinSensitivity').value);
  const targetBloodSugar = parseFloat(document.getElementById('targetBloodSugar').value);

  const carbDose = carbIntake / carbRatio;
  const correctionDose = (bloodSugar - targetBloodSugar) / insulinSensitivity;
  const totalDose = Math.max(0, carbDose + correctionDose);

  const roundedTotalDose = Math.round(totalDose * 2) / 2;

  modalBody.innerHTML = `
    <div class="alert alert-success">
      <h4>Rezultati izračuna:</h4>
      <p><strong>Ukupna doza inzulina:</strong> ${roundedTotalDose.toFixed(1)} jedinica</p>
      <p><strong>Korekciona doza inzulina:</strong> ${correctionDose.toFixed(1)} jedinica</p>
      <p><strong>Ugljikohidratna doza:</strong> ${carbDose.toFixed(1)} jedinica</p>
    </div>
    <h5>Uneseni podaci:</h5>
    <p><strong>Unos ugljikohidrata:</strong> ${carbIntake} g</p>
    <p><strong>Nivo šećera u krvi:</strong> ${bloodSugar.toFixed(1)} mmol/L</p>
    <p><strong>Omjer ugljikohidrata i inzulina:</strong> 1:${carbRatio}</p>
    <p><strong>Faktor osjetljivosti:</strong> ${insulinSensitivity}</p>
    <p><strong>Ciljani šećer u krvi:</strong> ${targetBloodSugar.toFixed(1)} mmol/L</p>
  `;

  resultModal.show();

  // Save to history
  const history = JSON.parse(localStorage.getItem('insulinHistory') || '[]');
  history.push({
    id: Date.now(),
    date: new Date().toISOString(),
    carbIntake,
    bloodSugar,
    carbRatio,
    insulinSensitivity,
    targetBloodSugar,
    totalDose: roundedTotalDose,
    correctionDose,
    carbDose
  });
  localStorage.setItem('insulinHistory', JSON.stringify(history));
});

function displayHistory() {
  const history = JSON.parse(localStorage.getItem('insulinHistory') || '[]');
  historyList.innerHTML = '';
  history.reverse().forEach(entry => {
    const date = new Date(entry.date).toLocaleString('bs-BA');
    historyList.innerHTML += `
      <div class="history-item" id="history-${entry.id}">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">${date}</h5>
          <i class="bi bi-trash delete-btn" onclick="deleteHistoryItem(${entry.id})"></i>
        </div>
        <div class="total-dose">
          Ukupna doza inzulina: ${entry.totalDose.toFixed(1)} jedinica
        </div>
        <div class="input-data">
          <h6>Uneseni podaci:</h6>
          <p><strong>Unos ugljikohidrata:</strong> ${entry.carbIntake} g</p>
          <p><strong>Šećer u krvi:</strong> ${entry.bloodSugar.toFixed(1)} mmol/L</p>
          <p><strong>Omjer ugljikohidrata i inzulina:</strong> 1:${entry.carbRatio}</p>
          <p><strong>Faktor osjetljivosti:</strong> ${entry.insulinSensitivity}</p>
          <p><strong>Ciljani šećer u krvi:</strong> ${entry.targetBloodSugar.toFixed(1)} mmol/L</p>
        </div>
        <div class="result-data">
          <h6>Rezultat:</h6>
          <p><strong>Korekciona doza:</strong> ${entry.correctionDose.toFixed(1)} jedinica</p>
          <p><strong>Ugljikohidratna doza:</strong> ${entry.carbDose.toFixed(1)} jedinica</p>
        </div>
      </div>
    `;
  });
}

function deleteHistoryItem(id) {
  let history = JSON.parse(localStorage.getItem('insulinHistory') || '[]');
  history = history.filter(item => item.id !== id);
  localStorage.setItem('insulinHistory', JSON.stringify(history));
  
  const itemToRemove = document.getElementById(`history-${id}`);
  itemToRemove.classList.add('animate__animated', 'animate__fadeOutRight');
  itemToRemove.addEventListener('animationend', () => {
    displayHistory();
  });
}
</script></body></html>
